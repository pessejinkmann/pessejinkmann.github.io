<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex's Segment Pizza Flow</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script>
    !function(){var i="analytics",analytics=window[i]=window[i]||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"];analytics.factory=function(e){return function(){if(window[i].initialized)return window[i][e].apply(window[i],arguments);var n=Array.prototype.slice.call(arguments);if(["track","screen","alias","group","page","identify"].indexOf(e)>-1){var c=document.querySelector("link[rel='canonical']");n.push({__t:"bpc",c:c&&c.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})}n.unshift(e);analytics.push(n);return analytics}};for(var n=0;n<analytics.methods.length;n++){var key=analytics.methods[n];analytics[key]=analytics.factory(key)}analytics.load=function(key,n){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute("data-global-segment-analytics-key",i);t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);analytics._loadOptions=n};analytics._writeKey="dCHOwjNOqPiHlWL66BZWrcxQsCj9IPdU";;analytics.SNIPPET_VERSION="5.2.0";
    analytics.load("dCHOwjNOqPiHlWL66BZWrcxQsCj9IPdU");
    analytics.page("Home");
    }}();
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 320px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        .logo-container {
            margin-bottom: 20px;
        }
        .logo {
            max-width: 200px;
            height: auto;
        }
        h2 { margin-top: 0; color: #333; }
        .pizza-list { display: flex; flex-wrap: wrap; justify-content: space-between; }
        .pizza-item { width: 48%; margin-bottom: 10px; cursor: pointer; }
        .pizza-item img { width: 100%; border-radius: 8px; }
        .pizza-item.selected {
            border: 2px solid #4CAF50;
            box-shadow: 0 0 15px rgba(76,175,80,0.5);
            transform: scale(1.05);
            border-radius: 5%;
        }
        button { width: 100%; padding: 10px; margin: 8px 0; border: none; border-radius: 4px; cursor: pointer; color: #fff; font-size: 16px; }
        .btn-primary { background-color: #4CAF50; }
        .btn-secondary { background-color: #da1d40; }
        .btn-tercenary { background-color: #7a1ba6; }
        .btn-info { background-color: #2196F3; }
        .btn-warning { background-color: #ff9800; }
        .btn-reset { background-color: #777; position: fixed; bottom: 20px; right: 20px; width: auto; padding: 8px 12px; }
        .hidden { display: none; }
        .toppings { text-align: left; margin: 10px 0; }
        .toppings label { display: block; margin-bottom: 5px; }
        .input-group { margin-bottom: 10px; margin-right: 15px ;text-align: left; }
        .input-group label { display: block; margin-bottom: 4px; color: #555; }
        .input-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="https://images.g2crowd.com/uploads/product/image/large_detail/large_detail_205c43a22cc9f5d110bca0feac5ef444/segment.png" 
                 alt="Segment" class="logo" width="200" height="40">
        </div>
        <hr class="rounded">
        <h2>Select your Pizza</h2>
        <div class="pizza-list">
            <div class="pizza-item" data-id="1" data-name="Pepperoni Pizza">
                <img src="pepperoni.webp" alt="Pepperoni" width="200" height="160">
                <p>Pepperoni</p>
            </div>
            <div class="pizza-item" data-id="2" data-name="Margherita Pizza">
                <img src="margherita.jpg" alt="Margherita" width="200" height="160">
                <p>Margherita</p>
            </div>
            <div class="pizza-item" data-id="3" data-name="Veggie Pizza">
                <img src="veggie.jpg" alt="Veggie" width="200" height="160">
                <p>Veggie</p>
            </div>
            <div class="pizza-item" data-id="4" data-name="BBQ Chicken Pizza">
                <img src="bbq_chicken.jpg" alt="BBQ Chicken" width="200" height="160">
                <p>BBQ Chicken</p>
            </div>
        </div>
        <button id="customizeBtn" class="btn-secondary hidden">Customize Pizza</button>
        <div id="toppingsGroup" class="toppings hidden">
            <h3>Choose Additinal Toppings</h3>
            <label><input type="checkbox" value="extra_cheese"> Extra Cheese (+$2.00)</label>
            <label><input type="checkbox" value="mushrooms"> Mushrooms (+$0.80)</label>
            <label><input type="checkbox" value="olives"> Olives (+$1.00)</label>
            <button id="saveToppingsBtn" class="btn-primary">Save Toppings</button>
        </div>
        <button id="addToCartBtn" class="btn-primary hidden">Add to Cart</button>
        <div id="accountChoice" class="hidden">
            <button id="haveAccountBtn" class="btn-primary" style="width:48%; display:inline-block;">Sign in</button>
            <button id="createAccountBtn" class="btn-info" style="width:48%; display:inline-block;">Create Account</button>
        </div>
        <form id="accountForm" class="hidden">
            <h3 id="accountFormTitle">Create Account</h3>
            <div class="input-group" id="nameGroup"><label>Name:</label><input type="text" id="acctName" required></div>
            <div class="input-group"><label>Email:</label><input type="email" id="acctEmail" required></div>
            <div class="input-group"><label>Zipcode:</label><input type="text" id="acctZip" required></div>
            <button id="submitAccountBtn" class="btn-info">Continue</button>
        </form>
        <button id="finishOrderBtn" class="btn-warning hidden">Create Order</button>
    </div>

    <button id="resetBtn" class="btn-reset">Reset Flow & userId</button>

    <script>

        let selected = {};
        // Utility
        function sendTrack(event, props) { analytics.track(event, { origin:"Website", timestamp:new Date().toISOString(), ...props }); }
        function simpleId() { return Date.now()+"-"+Math.random().toString(36).substr(2,5); }
        function resetFlow() {
            analytics.reset();
            selected = {};
            // hide all dynamic elements
            document.getElementById('customizeBtn').classList.add('hidden');
            document.getElementById('toppingsGroup').classList.add('hidden');
            document.getElementById('addToCartBtn').classList.add('hidden');
            document.getElementById('accountChoice').classList.add('hidden');
            document.getElementById('accountForm').classList.add('hidden');
            document.getElementById('finishOrderBtn').classList.add('hidden');
            // clear toppings checkboxes
            document.querySelectorAll('#toppingsGroup input[type="checkbox"]').forEach(cb => cb.checked = false);
            // clear account form
            document.getElementById('acctEmail').value = '';
            document.getElementById('acctName').value = '';
            document.getElementById('acctZip').value = '';
        }

        // Pizza selection
        document.querySelectorAll('.pizza-item').forEach(el => {
            el.addEventListener('click', () => {
                document.querySelectorAll('.pizza-item').forEach(i => i.classList.remove('selected'));
                el.classList.add('selected');
                selected.id = el.dataset.id;
                selected.name = el.dataset.name;
                analytics.page("Product", { product_id: selected.id, product_name: selected.name });
                sendTrack('Product Viewed', { product_id: selected.id, product_name: selected.name });
                document.getElementById('customizeBtn').classList.remove('hidden');
                document.getElementById('addToCartBtn').classList.remove('hidden');
                document.getElementById('toppingsGroup').classList.add('hidden');
                document.getElementById('accountChoice').classList.add('hidden');
                document.getElementById('accountForm').classList.add('hidden');
                document.getElementById('finishOrderBtn').classList.add('hidden');
            });
        });
        // Customize
        document.getElementById('customizeBtn').addEventListener('click', () => {
            analytics.page("Customize");
            document.getElementById('addToCartBtn').classList.toggle('hidden');
            document.getElementById('toppingsGroup').classList.toggle('hidden');
        });
        document.getElementById('saveToppingsBtn').addEventListener('click', () => {
            const tops = [...document.querySelectorAll('#toppingsGroup input:checked')].map(i=>i.value);
            selected.toppings = tops;
            sendTrack('Customize Pizza', { toppings: tops.join(', '), toppings_count: tops.length });
            document.getElementById('addToCartBtn').classList.remove('hidden');
            document.getElementById('toppingsGroup').classList.add('hidden');
        });
        // Add to cart
        document.getElementById('addToCartBtn').addEventListener('click', () => {
            analytics.page("Add to Cart");
            selected.toppings = selected.toppings?.join(', ') ?? ''
            sendTrack('Add to Cart', { product_id:selected.id, product_name:selected.name, toppings:selected.toppings});
            document.getElementById('accountChoice').classList.remove('hidden');
            document.getElementById('customizeBtn').classList.add('hidden');
            document.getElementById('addToCartBtn').classList.add('hidden');
            document.getElementById('toppingsGroup').classList.add('hidden');
        });
        // Account choice
        document.getElementById('haveAccountBtn').addEventListener('click', () => {
            analytics.page("Sign in");
            showAccountForm(false)}
        );
        document.getElementById('createAccountBtn').addEventListener('click', () => {
            analytics.page("Sign up");
            showAccountForm(true)
        });
        function showAccountForm(isCreate) {
            document.getElementById('accountChoice').classList.add('hidden');
            const form = document.getElementById('accountForm');
            document.getElementById('nameGroup').style.display = isCreate ? 'block' : 'none';
            document.getElementById('accountFormTitle').textContent = isCreate ? 'Create Account' : 'Sign in';
            form.classList.remove('hidden');
        }
        document.getElementById('submitAccountBtn').addEventListener('click', e => {
            e.preventDefault();
            const email = document.getElementById('acctEmail').value;
            const name = document.getElementById('acctName')?.value;
            const zip = document.getElementById('acctZip').value;
            analytics.identify(simpleId(), { email, name, zipcode:zip, origin:"Website" , timestamp:new Date().toISOString() });
            document.getElementById('accountForm').classList.add('hidden');
            document.getElementById('finishOrderBtn').classList.remove('hidden');
        });
        // Finish order
        document.getElementById('finishOrderBtn').addEventListener('click', () => {
            analytics.page("Finish Order")
            sendTrack('Order Placed', { product_id:selected.id, product_name:selected.name, toppings:selected.toppings});
            alert('Order Created!');
        });
        // Reset button
        document.getElementById('resetBtn').addEventListener('click', resetFlow);
    </script>
</body>
</html>
